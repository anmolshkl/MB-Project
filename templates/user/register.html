<!DOCTYPE html>
{% load static %}
<html lang="en">
    <head>
      {{ form.media }}
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Registeration</title> 
      <link rel="stylesheet" type="text/css" href="{% static 'css/modal/modal.css' %}" />
      
      <link rel="stylesheet" type="text/css" href="{% static 'css/jcrop/imgareaselect-default.css' %}" />
      <link rel="stylesheet" type="text/css" href="{% static 'css/user/register.css' %}" />

      <script type="text/javascript" src="{% static 'js/jcrop/jquery.min.js' %}"></script>
      <script type="text/javascript" src="{% static 'js/jcrop/jquery.imgareaselect.pack.js' %}"></script>
    </head>
    <body>
      
      <section class="modal--show" id="modal-text" tabindex="-1"
        role="dialog" aria-labelledby="modal-label" aria-hidden="true">

          <div class="modal-inner">
              <header id="modal-label"><!-- Header --></header>
              <div class="modal-content">
                
                <div class="block">
                  <form id="uploadForm" method="POST" action="/user/save-image/" enctype="multipart/form-data">
                    {% csrf_token %}
                    <label for="uncroppedPic">Upload a picture</label>
                    <input type="file" name="uncroppedPic" id="uncroppedPic" />
                    <input type="submit" value="UPLOAD" />
                  </form>
                </div>
                
                <div class="container block">
                  <p>
                    <img id="target" src="" style="float: left; margin-right: 10px;" />
                  </p>
                </div>

                <div class='block'>
                  <form id='cropForm' method="POST" action="/user/crop-image/" enctype="multipart/form-data">
                    {% csrf_token %}
                    <input type="hidden" id="x1" name="x1" value="" />
                    <input type="hidden" id="x2" name="x2" value="" />
                    <input type="hidden" id="y1" name="y1" value="" />
                    <input type="hidden" id="y2" name="y2" value="" />
                    <input type="hidden" id="w" name="w" value="" />
                    <input type="hidden" id="h" name="h" value="" /> 
                    <input type="submit" class="cropSubButton" value="Make this my profile pic!">
                    <!-- http://www.hongkiat.com/blog/loading-effect-in-buttons-ladda/ -->
                  </form>
                </div>
              </div>
          </div>

          <a href="#!" class="modal-close" title="Close this modal" data-close="Close"
              data-dismiss="modal">?</a>
      </section>      
            {% if selected == 'mentor' %}
            <!-- multistep form -->
            <form id="msform" method="POST" action="/user/register/" enctype="multipart/form-data">
              <!-- progressbar -->

              {% csrf_token %}

              <ul id="progressbar">
              <li class="active">Password</li>
              <li>Personal Details</li>
              <li>Education Details</li>
              </ul>
              <!-- fieldsets -->
              
              <fieldset>
                  <h2 class="fs-title">Password</h2>
                  <h3 class="fs-subtitle">Hush!Set your password</h3>
                  <div class="left">
                    <input type="hidden" name="selected" value="mentor">
                    <input type="hidden" name="is_new" value="False">
                    <label for="password1">Password</label>
                    <input type="password" name="password1" id="password1"><br>
                    <label for="password2">Confirm Password</label>
                    <input type="password" name="password2" id="password2">
                    
                    {% if error %}
                      {{ error }}
                    {% endif %}
                  
                  </div>
                  <input type="button" name="next" class="next action-button" value="Next" />
              </fieldset>
              
              
              
              <fieldset>
                  <h2 class="fs-title">Personal Details</h2>
                  <h3 class="fs-subtitle">Well,tell us more about yourself! :)</h3>
                  <div class="left">

                    <label for="{{ form.gender.id_for_label }}">Gender:</label>
                    {{ mentor_form.gender }}<br>
                    <div class="float">
                    <label for="{{ form.date_of_birth.id_for_label }}">Date of Birth:</label>
                    {{ mentor_form.date_of_birth }}
                    </div>
                    <div class="float">
                    <label for="{{ form.contact.id_for_label }}">Contact Number:</label>
                    {{ mentor_form.contact }}
                    </div>
                    <div class="float">
                    <label for="{{ form.location.id_for_label }}">City:</label>
                    {{ mentor_form.location }}
                    </div>
                    <div class="float">
                    <label for="{{ form.country.id_for_label }}">Country:</label>
                    {{ mentor_form.country }}
                    </div>
                    <label for="{{ form.about.id_for_label }}">About:</label>
                    {{ mentor_form.about }}
                    <label for="modal-link">Profile Picture:</label>
                    <a name="modal-link" href="#modal-text">Upload</a>

                  </div>
                  <input type="button" name="previous" class="previous action-button" value="Previous" />
                  <input type="button" name="next" class="next action-button" value="Next" />
              </fieldset>

              <fieldset>
                  <h2 class="fs-title">Education Details</h2>
                  <h3 class="fs-subtitle">So,where have you been? :)</h3>
                  <div class="left">
                      <label for="{{ education_form.institution.id_for_label }}">Institution:</label>
                       {{ education_form.institution }}
                      <div class="float">
                      <label for="{{ education_form.location.id_for_label }}">Location:</label>
                      {{ education_form.location }}
                      </div>
                      <div class="float">
                      <label for="{{ education_form.degree.id_for_label }}">Degree:</label>
                      {{ education_form.degree }}
                      </div>
                      <div class="float">
                      <label for="{{ education_form.branch.id_for_label }}">Branch:</label>
                      {{ education_form.branch }}
                      </div>
                      <div class="float">
                      <label for="{{ education_form.country.id_for_label }}"> Country:</label>
                      {{ education_form.country }}
                      </div>
                      <div class="float">
                      <label for="{{ education_form.from_year.id_for_label }}">From year:</label>
                      {{ education_form.from_year }}
                      </div>
                      <div class="float">
                      <label for="{{ education_form.to_year.id_for_label }}">To year:</label>
                      {{ education_form.to_year }}
                      </div>
                  </div>
                  <input type="button" name="previous" class="previous action-button" value="Previous" />
                  <input type="submit" name="submit" class="submit action-button" value="Submit" />
              </fieldset>

            </form>
            {% endif %}


      <!-- ========================================MENTEE ==================================== -->
            

            {% if selected == 'mentee' %}
            <!-- multistep form -->
            <form id="msform" method="POST" action="/user/register/" enctype="multipart/form-data">
              <!-- progressbar -->

              {% csrf_token %}

              <ul class="pb" id="progressbar">
              <li class="active">Password</li>
              <li>Personal Details</li>
              </ul>
              <!-- fieldsets -->
              
              <fieldset>
                  <h2 class="fs-title">Password</h2>
                  <h3 class="fs-subtitle">Hush!Set your password</h3>
                  <div class="left">
                    <input type="hidden" name="selected" value="mentee">
                    <input type="hidden" name="is_new" value="False">
                    <input type="hidden" name="is_mentor" value="False">
                    <label for="password1">Password</label>
                    <input type="password" name="password1" id="password1"><br>
                    <label for="password2">Confirm Password</label>
                    <input type="password" name="password2" id="password2">
                    
                    {% if error %}
                      {{ error }}
                    {% endif %}
                  
                  </div>
                  <input type="button" name="next" class="next action-button" value="Next" />
              </fieldset>
              
              
              
              <fieldset>
                  <h2 class="fs-title">Personal Details</h2>
                  <div class="left">
                      <div class="">
                      <label for="{{ mentee_form.gender.id_for_label }}">Gender:</label>
                       {{ mentee_form.gender }}<br>
                     </div>
                      <div class="">
                      <label for="{{ mentee_form.contact.id_for_label }}">Contact:</label>
                      {{ mentee_form.contact }}
                      </div>
                      <div class="float">
                      <label for="{{ mentee_form.college.id_for_label }}">College:</label>
                      {{ mentee_form.college }}
                      </div>
                      <div class="float">
                      <label for="{{ mentee_form.location.id_for_label }}">City:</label>
                      {{ mentee_form.location }}
                      </div>
                      <div class="float">
                      <label for="{{ mentee_form.state.id_for_label }}"> State:</label>
                      {{ mentee_form.state }}
                      </div>
                      <div class="float">
                      <label for="{{ mentee_form.country.id_for_label }}">Country:</label>
                      {{ mentee_form.country }}
                      </div>
                      <div class="">
                      <label for="{{ mentee_form.about.id_for_label }}">About:</label>
                      {{ mentee_form.about }}
                    </div>
                  </div>
                  <input type="button" name="previous" class="previous action-button" value="Previous" />
                  <input type="submit" name="submit" class="submit action-button" value="Submit" />
              </fieldset>
            </form>
            {% endif %}

        <!-- jQuery 
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        jQuery easing plugin --> 
        <script src="{% static 'js/user/jquery.easing.min.js' %}" type="text/javascript"></script> 
        <script src="{% static 'js/user/register.js' %}" type="text/javascript"></script>
        <script src="{% static 'js/modal/modal.js' %}" type="text/javascript"></script>
      
        <script>
        var ias; // Stores Instance of ImageAreaSelect
        $(document).ready(function() {
          $('#cropForm').hide();
        });


        function preview(img, selection) {
            var scaleX = 100 / (selection.width || 1);
            var scaleY = 100 / (selection.height || 1);
            
            var image = document.getElementById('target');

            $('#target + div > img').css({
                width: Math.round(scaleX * image.naturalWidth) + 'px',
                height: Math.round(scaleY * image.naturalHeight) + 'px',
                marginLeft: '-' + Math.round(scaleX * selection.x1) + 'px',
                marginTop: '-' + Math.round(scaleY * selection.y1) + 'px'
            });
            $('#x1').val(selection.x1);
            $('#y1').val(selection.y1);
            $('#x2').val(selection.x2);
            $('#y2').val(selection.y2);
            $('#w').val(selection.width);
            $('#h').val(selection.height);

            var tarImg  =document.getElementById('target');
            if(tarImg.naturalHeight > 400 || tarImg.naturalWidth >400) {
              $('#preview2').remove();
            }

            if(selection.width == 0) {
              $("#cropForm").hide();
            }
            else {
             $("#cropForm").show(); 
            }
        }


         //Program a custom submit function for the form
          $("#uploadForm").submit(function(event){
           
            //disable the default form submission
            event.preventDefault();
           
            //grab all form data  
            var formData = new FormData($(this)[0]);


            $.ajax({
              url: '/user/save-image/',
              type: 'POST',
              data: formData,
              async: false,
              cache: false,
              contentType: false,
              processData: false,
              success: function (returndata) {
                $('#target').attr("src",returndata);
                $('#target').css("display","block");
                $('#target').css("visibility","visible");
               

                var oldPreview = $('#preview');

                 if(oldPreview != undefined) {
                  $("#preview").remove();
                 }

               $('<div><img id="preview2" src='+returndata+' style="position: relative;" /></div>').css({
                    float: 'left',
                    position: 'relative',
                    overflow: 'hidden',
                    width: '100px',
                    height: '100px'
                })
                .insertAfter($('#target'));


                ias = $('#target').imgAreaSelect({ 
                  aspectRatio: '1:1',
                  handles: true,
                  fadeSpeed: 200, 
                  onSelectChange: preview,
                  maxHeight: 400, 
                  maxWidth: 400, 
                  minHeight: 150, 
                  minWidth: 150,
                  instance: true,
                });

                $('#cropForm').show();
              }
            });
        });


        $('.modal-close').click(function() {
          ias.cancelSelection();
        });
        //Program a custom submit function for the form
          $("#cropForm").submit(function(event){
           
            //disable the default form submission
            event.preventDefault();
           
            //grab all form data  
            var input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "url").val($('#target').attr('src'));
            $('#cropForm').append($(input));
            var formData = new FormData($(this)[0]);
            
            $.ajax({
              url: '/user/crop-image/',
              type: 'POST',
              data: formData,
              async: false,
              cache: false,
              contentType: false,
              processData: false,
              success: function (returndata) {
                  if(returndata == 'Success') {
                     ias.cancelSelection();
                     $('.modal-close')[0].click();
                  }
              }
            });
        });
        </script>
  
   </body>

</html>
