<!DOCTYPE html>
{% load static %}
<html lang="en">
    <head>
      {{ form.media }}
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Registeration</title> 
      <link rel="stylesheet" type="text/css" href="{% static 'css/user/register.css' %}" />
      <link rel="stylesheet" type="text/css" href="{% static 'css/modal/modal.css' %}" />
      
      <link rel="stylesheet" href="{% static 'css/jcrop/jquery.Jcrop.css' %}" type="text/css" />
      
      <script src="{% static 'js/jcrop/jquery.min.js' %}"></script>
      <script src="{% static 'js/jcrop/jquery.Jcrop.js' %}"></script>

    </head>
    <body>

      <section class="modal--show" id="modal-text" tabindex="-1"
        role="dialog" aria-labelledby="modal-label" aria-hidden="true">

          <div class="modal-inner">
              <header id="modal-label"><!-- Header --></header>
              <div class="modal-content">
                <form id="uploadForm" method="POST" action="/user/save-image/" enctype="multipart/form-data">
                  {% csrf_token %}
                  <label for="uncroppedPic">Upload a picture</label>
                  <input type="file" name="uncroppedPic" id="uncroppedPic" />
                  <input type="submit" value="UPLOAD" />
                </form>
                <table cellpadding="0" cellspacing="0" border="0">
                <tr>
                <td>
                <img src="" id="target" />
                </td>
                <td>
                <div style="width:100px;height:100px;overflow:hidden;margin-left:5px;">
                  <img src="" id="preview" />
                </div>

                </td>
                </tr>
                </table>
      
              </div>
               
              <footer><!-- Footer --></footer>
          </div>

          <a href="#!" class="modal-close" title="Close this modal" data-close="Close"
              data-dismiss="modal">?</a>
      </section>
      
      <h1>Welcome to Mentor Buddy Registeration</h1>
            {% if selected == 'mentor' %}
            <!-- multistep form -->
            <form id="msform" method="POST" action="/user/register/" enctype="multipart/form-data">
              <!-- progressbar -->

              {% csrf_token %}

              <ul id="progressbar">
              <li class="active">Password</li>
              <li>Personal Details</li>
              <li>Education Details</li>
              </ul>
              <!-- fieldsets -->
              
              <fieldset>
                  <h2 class="fs-title">Password</h2>
                  <h3 class="fs-subtitle">Hush!Set your password</h3>
                  <div class="left">
                    <input type="hidden" name="selected" value="mentor">
                    <input type="hidden" name="is_new" value="False">
                    <label for="password1">Password</label>
                    <input type="password" name="password1" id="password1"><br>
                    <label for="password2">Confirm Password</label>
                    <input type="password" name="password2" id="password2">
                    
                    {% if error %}
                      {{ error }}
                    {% endif %}
                  
                  </div>
                  <input type="button" name="next" class="next action-button" value="Next" />
              </fieldset>
              
              
              
              <fieldset>
                  <h2 class="fs-title">Personal Details</h2>
                  <h3 class="fs-subtitle">Well,tell us more about yourself! :)</h3>
                  <div class="left">

                    <label for="{{ form.gender.id_for_label }}">Gender:</label>
                    {{ mentor_form.gender }}
                    <label for="{{ form.date_of_birth.id_for_label }}">Date of Birth:</label>
                    {{ mentor_form.date_of_birth }}
                    <label for="{{ form.contact.id_for_label }}">Contact Number:</label>
                    {{ mentor_form.contact }}
                    <label for="{{ form.location.id_for_label }}">City:</label>
                    {{ mentor_form.location }}
                    <label for="{{ form.country.id_for_label }}">Country:</label>
                    {{ mentor_form.country }}
                    <label for="{{ form.about.id_for_label }}">About:</label>
                    {{ mentor_form.about }}
                    <label for="modal-link">Profile Picture:</label>
                    <a name="modal-link" href="#modal-text">Upload</a>

                  </div>
                  <input type="button" name="previous" class="previous action-button" value="Previous" />
                  <input type="button" name="next" class="next action-button" value="Next" />
              </fieldset>

              <fieldset>
                  <h2 class="fs-title">Education Details</h2>
                  <h3 class="fs-subtitle">So,where have you been? :)</h3>
                  <div class="left">
                      {{ education_form.as_p }}
                  </div>
                  <input type="button" name="previous" class="previous action-button" value="Previous" />
                  <input type="submit" name="submit" class="submit action-button" value="Submit" />
              </fieldset>

            </form>
            {% endif %}


      <!-- ========================================MENTEE ==================================== -->
            

            {% if selected == 'mentee' %}
            <!-- multistep form -->
            <form id="msform" method="POST" action="/user/register/" enctype="multipart/form-data">
              <!-- progressbar -->

              {% csrf_token %}

              <ul id="progressbar">
              <li class="active">Password</li>
              <li>Personal Details</li>
              </ul>
              <!-- fieldsets -->
              
              <fieldset>
                  <h2 class="fs-title">Password</h2>
                  <h3 class="fs-subtitle">Hush!Set your password</h3>
                  <div class="left">
                    <input type="hidden" name="selected" value="mentee">
                    <input type="hidden" name="is_new" value="False">
                    <input type="hidden" name="is_mentor" value="False">
                    <label for="password1">Password</label>
                    <input type="password" name="password1" id="password1"><br>
                    <label for="password2">Confirm Password</label>
                    <input type="password" name="password2" id="password2">
                    
                    {% if error %}
                      {{ error }}
                    {% endif %}
                  
                  </div>
                  <input type="button" name="next" class="next action-button" value="Next" />
              </fieldset>
              
              
              
              <fieldset>
                  <h2 class="fs-title">Personal Details</h2>
                  <h3 class="fs-subtitle">Well,tell us more about yourself! :)</h3>
                  <div class="left">
                    {{ mentee_form.as_p }}
                  </div>
                  <input type="button" name="previous" class="previous action-button" value="Previous" />
                  <input type="submit" name="submit" class="submit action-button" value="Submit" />
              </fieldset>

            </form>
            {% endif %}

        <!-- jQuery 
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        jQuery easing plugin --> 
        <script src="{% static 'js/user/jquery.easing.min.js' %}" type="text/javascript"></script> 
        <script src="{% static 'js/user/register.js' %}" type="text/javascript"></script>
        <script src="{% static 'js/modal/modal.js' %}" type="text/javascript"></script>
      
        <script>
         //Program a custom submit function for the form
          $("#uploadForm").submit(function(event){
           
            //disable the default form submission
            event.preventDefault();
           
            //grab all form data  
            var formData = new FormData($(this)[0]);
           
            $.ajax({
              url: '/user/save-image/',
              type: 'POST',
              data: formData,
              async: false,
              cache: false,
              contentType: false,
              processData: false,
              success: function (returndata) {
                $("#uploadForm").remove();
                $('#target').attr("src",returndata);
                $('#target').css("display","block");
                $('#target').css("visibility","visible");
               
                
                
                $('#preview').attr("src",returndata);
                $('#preview').css("display","block");
                $('#preview').css("visibility","visible");

                $('#target').Jcrop({
                  onChange: showPreview,
                  onSelect: showPreview,
                  onRelease: hidePreview,
                  aspectRatio: 1
                });
                  var $preview = $('#preview');
                  // Our simple event handler, called from onChange and onSelect
                  // event handlers, as per the Jcrop invocation above
                  function showPreview(coords)
                  {
                    if (parseInt(coords.w) > 0)
                    {
                      alert("Called");
                      var rx = 100 / coords.w;
                      var ry = 100 / coords.h;

                      $preview.css({
                        width: Math.round(rx * 500) + 'px',
                        height: Math.round(ry * 370) + 'px',
                        marginLeft: '-' + Math.round(rx * coords.x) + 'px',
                        marginTop: '-' + Math.round(ry * coords.y) + 'px'
                      }).show();
                    }
                  }
                  function hidePreview()
                  {
                    $preview.stop().fadeOut('fast');
                  }
              }
            });
        });
        </script>
  
   </body>

</html>
