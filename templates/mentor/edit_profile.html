{% extends 'mentor/base.html' %}
{% load static %}
{% block stylesheets %}
    <style>
    .page-content {
        background-image: url({% static 'img/bg11.jpg' %}) !important;
        background-size: cover;
    }
    .tab-content {
        padding: 20px !important;
    }
    .basic-form input  {
        width: 50% !important;
    }
    .education-form {
        /*background-image: url("{% static 'img/geometry16.jpg' %}") !important;*/
        background-color: #81D4FA;
        box-shadow: 0px 2px 5px 0px rgba(0, 0, 0, 0.26) !important;
    }
    .education-form h3, education-form lable {
        color: black !important;
        line-height: 1 !important;
        margin-bottom: 0px !important;
    }
    .education-form .form-group {
        display: inline-block !important;
        margin: 5px;
    }
    .education-form input {

        background-color: transparent;
    }
    .employment-form label, .employment-form h3, .employment-form input {
        display: inline !important;
        max-width: 200px !important;
    }
    .nav-tabs {
        background-color: transparent !important;
    }
    .margin-s {
        margin-top: 10px !important;
    }
    .tab-form {
        margin: 0px auto;
    }
    .cnt {
        display: block;
        margin: 0 auto;
        max-width: 300px;
    }
    .btn-round {
        background-color: #d23f31;
        border-radius: 999em;
        width: 56px;
        height: 56px;
        box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
        line-height: 1;
        font-size: 36px;
        position: relative;
        cursor: pointer;
    }

    .btn-round span {
        position: absolute;
         left: 0;
        top: 50%;
        height: 100%;
        width: 100%;
        text-align: center;
        margin-top: -22px;
        color: #FFF;
    }
    </style>
{%  endblock %}
{% block container_title %}<h2>Edit Profile</h2>{% endblock %}

{% block container_block %}
    <!--
   <a class="btn btn-primary margin-s" href="/accounts/linkedin/login/?method=oauth2&next=/mentor/get-data/">Get you data from your LinkedIn profile</a>
    -->
    <form id="tab-form">
    <div role="tabpanel" class="tab-form margin-s">
      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Basic</a></li>
        <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Personal</a></li>
        <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Education</a></li>
        <li role="presentation"><a href="#settings" aria-controls="settings" role="tab" data-toggle="tab">Employment</a></li>
      </ul>

      <!-- Tab panes -->
      <div class="tab-content">
        <div role="tabpanel" class="tab-pane fade in active" id="home">
            {% csrf_token %}
          <div class="basic-form center">
            {% for field in user_form %}

             <div class="form-group">
                <label class="form-label"><h4>{{ field.label }}</h4></label>
                    <br>
                  {{ field }}
              </div>
            {% endfor %}
            </div>
        </div>

        <div role="tabpanel" class="tab-pane fade" id="profile">
            {% for field in form %}
             <div class="form-group">
                <label class="form-label"><h4>{{ field.label }}</h4></label>
                    <br>
                  {{ field }}
              </div>
            {% endfor %}
        </div>
        <div role="tabpanel" class="tab-pane fade" id="messages">
        {% if edu_formset.total_form_count != 0 %}
            {% for edu_form in edu_formset %}
                <div class="row well education-form">
                {% for field in edu_form %}
                    {% if field.label != 'Delete' %}
                     <div class="form-group">

                        {% if field.label != 'Parent' and field.label != 'Id' %}
                        <h3>{{ field.label_tag }}</h3>

                         {% endif %}
                          {{ field }}
                     </div>
                     {% else %}
                        <div class="checkbox check-danger margin-s">
                        {{ field }}
                        {{ field.label_tag }}
                         </div>
                     {% endif %}

                {% endfor %}
                </div>
            {% endfor %}
        {% else %}
            <div class="row well education-form" style="display: none">
                {% for field in edu_formset.empty_form %}
                     <div class="form-group">
                        {% if field.label != 'Parent' and field.label != 'Id' %}
                            <h3>{{ field.label_tag }}</h3>
                              <br>
                         {% endif %}
                            {{ field }}
                      </div>
                {% endfor %}

            </div>
        {% endif %}
        {{ edu_formset.management_form }}
        <a class="cnt btn-round" id="addMoreEdu"><span>+</span></a>
        </div>
        <div role="tabpanel" class="tab-pane fade" id="settings">
            {% if emp_formset.total_form_count != 0 %}
                {% for emp_form in emp_formset %}
                    <div class="row well employment-form form-inline">
                    {% for field in emp_form %}
                         <div class="form-group">
                            {% if field.label != 'Parent' and field.label != 'Id' %}
                            <h3>{{ field.label_tag }}</h3>
                                <br>
                             {% endif %}
                              {{ field }}
                          </div>
                    {% endfor %}
                    </div>
                {% endfor %}
            {% else %}
                <div class="row well employment-form form-inline" style="display: none">
                    {% for field in emp_formset.empty_form %}
                         <div class="form-group">
                            {% if field.label != 'Parent' and field.label != 'Id' %}
                            <h3>{{ field.label_tag }}</h3>
                                <br>
                             {% endif %}
                              {{ field }}
                          </div>
                    {% endfor %}
                </div>
            {% endif %}
            {{ emp_formset.management_form }}
        <a class="btn-round cnt" id="addMoreEmp"><span>+</span></a>
        </div>
      </div>

    </div>
    </form>
    <a class="btn btn-success btn-large cnt update"> Update</a>
{% endblock %}

{% block scripts %}
    <script src="{%  static 'morph/classie.js' %}"></script>
    <script>
        $('.update').click(function() {
            var data = $('#tab-form').serializeArray();
            $.ajax({
                url: '/mentor/edit-profile/',
                data: data,
                type: 'post',
                success: function() {
                    alert("maza a gaya");
                }
            });
        });
    </script>
    <script>
        /* http://stackoverflow.com/questions/501719/dynamically-adding-a-form-to-a-django-formset-with-ajax */
        function cloneMore(selector, type) {
            var newElement = $(selector).clone(true);
            var total = $('#id_' + type + '-TOTAL_FORMS').val();
            newElement.find(':input').each(function() {
                var name = $(this).attr('name').replace('-' + (total-1) + '-','-' + total + '-');
                var id = 'id_' + name;
                $(this).attr({'name': name, 'id': id}).val('').removeAttr('checked');
            });
            newElement.find('label').each(function() {
                var newFor = $(this).attr('for').replace('-' + (total-1) + '-','-' + total + '-');
                $(this).attr('for', newFor);
            });
            total++;
            $('#id_' + type + '-TOTAL_FORMS').val(total);
            $(selector).after(newElement);
        }

        $('#addMoreEdu').click(function() {
            cloneMore('.education-form:last', 'educationdetails_set');
            $('.education-form:last').show();
        });

        $('#addMoreEmp').click(function() {
            cloneMore('.employment-form:last', 'employmentdetails_set');
            $('.employment-form:last').show();
        });
        // Now we need to change the prefix of empty form generated by django
        {% if emp_formset.total_form_count == 0 %}
            $('.employment-form input').each(function() {
               var newName = $(this).attr('name').replace('__prefix__',"0");
               var newId = $(this).attr('id').replace('__prefix__',"0");
                $(this).attr({'name': newName, 'id': newId});
            });
        {% endif %}

        {% if edu_formset.total_form_count == 0 %}
            $('.education-form input').each(function() {
               var newName = $(this).attr('name').replace('__prefix__',"0");
               var newId = $(this).attr('id').replace('__prefix__',"0");
                $(this).attr({'name': newName, 'id': newId});
            });
        {% endif %}
    </script>
{%  endblock %}
